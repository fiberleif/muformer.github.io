---
permalink: /
layout: single
classes: wide
toc: false
excerpt: "A Deep Learning Framework for Accurate Protein Fitness Landscape Modeling"
header:
    overlay_color: "#333"
    actions:
     - label: "arXiv"
       url: "https://arxiv.org/abs/2106.06800"
---
<style>
    h2 {
        font-size: large;
    };
    th {
        font-size: 0.8em;
        text-align: center;
        cursor: pointer;
    }
    td {
        font-size: 0.8em; 
        text-align: center;
    }
    i {
        cursor: pointer;
    }
    summary {
        display: inline;
        cursor: pointer;
    }
    summary::-webkit-details-marker {
        display: none;
    }
    details[open] summary * i[class="fas fa-angle-right"] {
        transform: rotate(90deg);
    }
</style>
<!-- <link rel="stylesheet" type="text/css" href="https://www.ebi.ac.uk/pdbe/pdb-component-library/css/pdbe-molstar-3.1.0.css"> -->
<link rel="stylesheet" type="text/css" href="https://www.ebi.ac.uk/pdbe/pdb-component-library/css/pdbe-molstar-light-3.1.0.css">
<script type="text/javascript" src="https://cdn.bootcdn.net/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
<script type="text/javascript" src="https://www.ebi.ac.uk/pdbe/pdb-component-library/js/pdbe-molstar-plugin-3.1.0.js"></script>
<script type="text/javascript" src="https://cdn.plot.ly/plotly-2.25.2.min.js" charset="utf-8"></script>
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/d3@7"></script>

<div id="summary">
    <h1 id="header-summary" class="text-center">Abstract</h1>
    <p class="text-justify" style="font-size: large">Protein engineering is essential for a variety of applications, such as designing biologic drugs, optimizing enzymes, and developing novel functional molecules. Accurate protein fitness landscape modeling, such as predicting protein properties in sequence space, is critical for efficient protein engineering. Yet, due to the complexity of the landscape and high-dimensional sequence space, it remains as an unsolved problem. In this work, we present μFormer, a deep learning framework that combines a pre-trained protein language model with three scoring modules targeting protein features at multiple levels, to tackle this grand challenge. μFormer achieves state-of-the-art performance across diverse tasks, including predicting high-order mutants, modeling epistatic effects, handling insertion/deletion mutations, and generalizing to out-of-distribution scenarios. On the basis of prediction power, integrating μFormer with a reinforcement learning framework enables efficient exploration of the vast mutant space. We showcase that this integrated approach can design protein variants with up to 5-point mutations and potentially significant enhancement in activity for engineering tasks. The results highlight μFormer as a powerful and versatile tool for protein design, accelerating the development of innovative proteins tailored for specific applications.</p>
</div>
<div id="results" style="width:100%">
    <details open>
        <summary>
            <h1 id="header-results">Results  <i class="fas fa-angle-right"></i></h1>
        </summary>
        <h2 id="header-results-fitness">Fitness score</h2>
        <div id="container-results-fitness" style="width:100%">
            <div style="display:inline-block;width:100%;height:470px">
                <div id="fitness-surfaceplot" style="position: absolute; right: 0px"></div>
                <div style="float: left; width:45%">
                    <table id="fitness-table" style="width:100%;display:table;height:420px"></table>
                    <p id="pagination-para" style="font-size: medium"></p>
                </div>
            </div>
            <div id="fitness-query" style="font-size:medium;display:block;width:100%"></div>
            <div id="fitness-score" style="font-size:medium;display:block;width:100%">
                <!-- <p id="fitness-score-exp">Experimental Scores: </p> -->
                <!-- <p id="fitness-score-predicted">Predicted Scores: </p> -->
                <a href="#results" class="btn btn--primary" id="fitness-search" style="width:47%"><div style="margin:auto">Go</div></a>
                <a href="#results" class="btn btn--primary" id="fitness-search-reset" style="width:47%"><div style="margin:auto">Reset</div></a>
            </div>
        </div>
        <div id="fitness-structure" style="position:relative; height: 400px; width:94%"></div>
        <h2 id="header-results-epistatic">Epistatic effects</h2>
    </details>
</div>
<div id="applications">
    <details open>
        <summary>
            <h1 id="header-applications">Applications  <i class="fas fa-angle-right"></i></h1>
        </summary>
        <h2 id="header-applications-lactamase">Beta-lactamase</h2>
        <div id="container-applications-lactamase" style="width: 100%">
            <img src="assets/figures/rl_density.gif" alt="rl_density" width="40%" style="margin: left 0;"/>
            <img src="assets/figures/rl_topk.gif" alt="rl_topk" width="55%" style="margin: right 0;"/>
        </div>
        <h2 id="header-applications-antibody">SARS-CoV2 antibody</h2>
</details>
</div>
<div id="method">
    <details open>
        <summary>
            <h1 id="header-method">Method & Concept  <i class="fas fa-angle-right"></i></h1>
        </summary>
        <h2 id="header-method-pretraining">Protein LLM</h2>
        <h2 id="header-method-rl">Reinforcement Learning</h2>
    </details>
</div>

<script>
    async function LoadTable(tablefilepath) {
        var rows = await d3.tsv(tablefilepath);
        rows = rows.map(function(row) {
            var newrow = {};
            for (var key in row) {
                if (key == 'prediction') {
                    newrow[key] = parseFloat(row[key]).toFixed(4);
                } else {
                    newrow[key] = row[key];
                }
            }
            return newrow;
        });
        return rows;
    }
    function ShowPagedTable(rows, tablepos, colnames, pageidx, recperpage=10) {
        subset_rows = rows.slice(pageidx*recperpage, (pageidx+1)*recperpage);
        $(tablepos).empty();
        $(tablepos).html("<thead style='width: 100%;'><tr style='width: 100%;'></tr></thead><tbody style='width: 100%;'></tbody>");
        for (colname of colnames) {
            var toshow_colname = transformcolname(colname);
            $(tablepos + ' thead tr').append("<th>" + toshow_colname + '</th>');
        }
        for (row of subset_rows) {
            var newrow = '<tr>'
            for (colname of colnames) {
                var toshow_content = row[colname];
                newrow += "<td style='white-space: nowrap;'>" + toshow_content + '</td>';
            }
            newrow += '</tr>';
            $(tablepos + ' tbody').append(newrow);
        }
    }
    function transformcolname(colname) {
        var colname_dict = {
            'pos': 'Residue Indices',
            'score': 'Experimental<br>Fitness',
            'prediction': 'Predicted<br>Fitness',
            'mutant': 'Mutants',
        }
        return colname_dict[colname];
    }
    function removeduplicates(arr) {
        return arr.filter(function(item, pos) {
            return arr.indexOf(item) == pos;
        }).sort(function(a, b) {
            return a - b;});
    }
    function PreparePlotData(rows) {
        console.log(rows[0])
        var y_names = Object.keys(rows[0]);
        y_names = y_names.filter(function(y) {return y != 'x';});
        var x_names = rows.map(function(row) {
            return row['x'];
        });
        var z_data = [];
        var datarows = rows.map(function(row) {
            var newrow = {};
            for (var key in row) {
                if (key != 'x') {
                    newrow[key] = parseFloat(row[key]);
                }
            }
            return newrow;
        });
        var z_data = datarows.map(function(row) {
            return Object.values(row);
        });
        return [x_names, y_names, z_data];
    }
    function PlotSurface(x_names, y_names, z_data, figpos) {
        var data = [{
            z: z_data,
            type: 'surface',
            contours: {
                z: {
                show:true,
                usecolormap: true,
                highlightcolor:"#42f462",
                project:{z: true}
                }
            },
            showscale: false
        }];
        var tick_step = 5;
        var layout = {
            title: 'Fitness Landscape',
            autosize: true,
            width: 500,
            height: 480,
            margin: {
                l: 0,
                r: 0,
                b: 20,
                t: 0,
            },
            scene: {
                xaxis: {
                    title: 'Residue Index',
                    tickvals: [...Array(x_names.length).keys()].filter(function(x) {return x % tick_step == 0;}),
                    ticktext: x_names.map(function(x) {return x.toString();}).filter(function(x, i) {return i % tick_step == 0;}),
                    tickmode: 'array',
                },
                yaxis: {
                    title: 'Residue Index',
                    tickvals: [...Array(y_names.length).keys()].filter(function(y) {return y % tick_step == 0;}),
                    ticktext: y_names.map(function(y) {return y.toString();}).filter(function(y, i) {return i % tick_step == 0;}),
                    tickmode: 'array',
                },
                camera: {
                    center: {
                        x: 0,
                        y: 0,
                        z: -0.4,
                    },
                    eye: {
                        x: -1,
                        y: -2,
                        z: 0.5,
                    },
                }
            }
        };
        Plotly.newPlot(figpos, data, layout);
    }
    function comparer(index) {
        return function(a, b) {
            var valA = a[index], valB = b[index];
            return $.isNumeric(valA) && $.isNumeric(valB) ? valA - valB : valA.toString().localeCompare(valB)
        }
    }
    function SortTable(parsed, index, asc=true) {
        var sorted = parsed.sort(comparer(index));
        if (!asc) {
            sorted.reverse();
        };
        return sorted
    }
    function UpdatePagination(parsed, pagebtn_idprefix="page-", pagebtn_loc="pagination-para", numrows=10) {
        $("#"+pagebtn_loc).html("Page: ");
        var numpages = Math.ceil(parsed.length / numrows);
        const shownumpages = 3;
        for (let i = 1; i <= numpages; i++) {
            $("#"+pagebtn_loc).append("<a name='page-button' id='" + pagebtn_idprefix + i + "' href='#browse' class='btn btn--inverse'>" + i + "</a> ");
            if ((i <= shownumpages) || (i === numpages)) {
            } else {
                $("#"+pagebtn_idprefix + i).hide();
            };
            if (i === 1) {
                $("#"+pagebtn_loc).append("<span id="+pagebtn_idprefix+"sep-first> </span>");
            } else if (i === numpages-1) {
                $("#"+pagebtn_loc).append("<span id="+pagebtn_idprefix+"sep-last>... </span>");
            } else {
            };
        };
        $("#"+pagebtn_idprefix+"1").attr("class", "btn btn--light-outline");
    }
    function ChangePage(pageindex, pagebtn_idprefix="page-", pagebtn_loc="pagination-para") {
        var pageindex = parseInt(pageindex);
        const shownumpages = 2;
        var numpages = $("#pagination-para a").length;
        $.each($("#"+pagebtn_loc+" a"), function(index, element) {
            $(element).hide();
        });
        $("a[class='btn btn--light-outline']").attr("class", "btn btn--inverse");
        var firstpageindex = Math.max(1, pageindex - shownumpages);
        var lastpageindex = Math.min(pageindex + shownumpages, numpages);
        for (let i = firstpageindex; i <= lastpageindex; i++) {
            $("#"+pagebtn_idprefix+ i).show();
        };
        $("#page-" + pageindex).attr("class", "btn btn--light-outline");
        if (firstpageindex > 1) {
            $("#"+pagebtn_idprefix+"1").show();
        };
        if (lastpageindex < numpages) {
            $("#"+pagebtn_idprefix + numpages).show();
        };
        if (firstpageindex > 2) {
            $("#"+pagebtn_idprefix+"sep-first").text("... ");
        } else {
            $("#"+pagebtn_idprefix+"sep-first").text(" ");
        };
        if (lastpageindex < numpages-1) {
            $("#"+pagebtn_idprefix+"sep-last").text("... ");
        } else {
            $("#"+pagebtn_idprefix+"sep-last").text(" ");
        };
    }
    function AddQueryMutation(rows, mutation_colname='mutant', query_loc='fitness-query', maxnum=5, curridx=2, addminus=false) {
        var maxnum_mutations = rows.map(function(row) {
            return row[mutation_colname].split(',').length;
        }).reduce(function(a, b) {
            return Math.max(a, b);
        });
        maxnum_mutations = Math.min(maxnum_mutations, maxnum); 
        var i = curridx;
        if (i == 1) {
            var number_suffix = "st";
        } else if (i == 2) {
            var number_suffix = "nd";
        } else if (i == 3) {
            var number_suffix = "rd";
        } else {
            var number_suffix = "th";
        }
        $("#"+query_loc).append("<div id='fitness-mutation-div-" + i + "' style='display:inline-block'></div>")
        $("#"+"fitness-mutation-div-" + i).append("<label for='fitness-mutation-" + i + "' style='display:inline'>" + i + "<sup>" + number_suffix + "</sup> Mutation:&nbsp&nbsp</label>");
        $("#"+"fitness-mutation-div-" + i).append("<input list='fitness-mutation-select-" + i + "' id='fitness-mutation-" + i + "' style='width: 5em'>");
        $("#"+"fitness-mutation-div-" + i).append("<datalist id='fitness-mutation-select-" + i + "'></datalist>");
        if (i < maxnum_mutations) {
            $("#"+"fitness-mutation-div-" + i).append("<i curridx="+i+" class='fas fa-plus' style='color: #323c4d;'></i>&nbsp&nbsp");
        }
        if (addminus && (i > 1)) {
            $("#"+"fitness-mutation-div-" + i).append("<i curridx="+i+" class='fas fa-minus' style='color: #323c4d;'></i>&nbsp&nbsp");
        }
        $("#"+"fitness-mutation-div-" + i).append("<br>");
    }
    function UpdateMutationOptions(rows, mutation_select_id="#fitness-mutation-select-1", mutation_colname='mutation') {
        mutation_options = rows.map(function(row) {
            return row[mutation_colname];
        });
        for (mutation of mutation_options) {
            $(mutation_select_id).append("<option value='" + mutation + "'>" + "</option>");
        }
        return mutation_options;
    }
    function SubsetTable(rows, mutations_str, mutation_colname='mutant') {
        var query_mutations = mutations_str.split(',');
        var next_rows = rows.filter(function(row) {
            return query_mutations.map(function(query_mutation) {
                return row[mutation_colname].includes(query_mutation);
            }).reduce(function(a, b) {
                return a && b;
            });
        });
        return next_rows
    }
    function TablePipeline(rows) {
        ShowPagedTable(rows, '#fitness-table', ['mutant', 'score', 'prediction'], 0, 10);
        UpdatePagination(rows);
        $("a[name='page-button']").click(function() {
            var pageindex = $(this).text();
            ChangePage(pageindex);
            ShowPagedTable(rows, '#fitness-table', ['mutant', 'score', 'prediction'], pageindex-1, 10);
        });
    }
    $(document).ready(function() {
        var viewerInstance = new PDBeMolstarPlugin();
        var options = {
        moleculeId: '1cbs',
        bgColor: {r:255, g:255, b:255},
        hideControls: true,
        }
        var viewerContainer = document.getElementById('fitness-structure');
        viewerInstance.render(viewerContainer, options);
        
        LoadTable('assets/tables/predictions/aav_less5.tsv').then(function(rows) {
            LoadTable('assets/tables/mutations/aav_less5_mutations.tsv').then(function(mutations) {
                TablePipeline(rows);
                AddQueryMutation(rows, 'mutant', 'fitness-query', 5, 1);
                UpdateMutationOptions(mutations);
                $("#fitness-query").on('click', "i[class='fas fa-plus']", function() {
                    var curridx = parseInt($(this).attr('curridx'));
                    AddQueryMutation(rows, 'mutant', 'fitness-query', 5, curridx+1, true);
                    $(this).remove();
                    UpdateMutationOptions(mutations, "#fitness-mutation-select-"+(curridx+1));
                });
                $("#fitness-query").on('click', "i[class='fas fa-minus']", function() {
                    $(this).parent().remove();
                });
                $("#fitness-search").click(function() {
                    var query_mutations = [];
                    $.each($("#fitness-query input"), function(index, element) {
                        query_mutations.push($(element).val());
                    });
                    query_mutations = query_mutations.filter(function(query_mutation) {
                        return query_mutation != '';
                    });
                    var query_mutations_str = removeduplicates(query_mutations).join(',');
                    var target_rows = SubsetTable(rows, query_mutations_str, 'mutant')
                    TablePipeline(target_rows);
                });
                $("#fitness-search-reset").click(function() {
                    TablePipeline(rows);
                    $("#fitness-query").empty();
                    AddQueryMutation(rows, 'mutant', 'fitness-query', 5, 1);
                    UpdateMutationOptions(mutations);
                });
            });
            LoadTable('assets/tables/plotdata/aav_less5_pred.tsv').then(function(predictions) {
                var [x_names, y_names, z_data] = PreparePlotData(predictions);
                PlotSurface(x_names, y_names, z_data, 'fitness-surfaceplot');
            });
        });
        
    });
    
</script>